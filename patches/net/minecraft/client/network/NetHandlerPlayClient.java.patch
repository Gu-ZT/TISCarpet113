--- a/net/minecraft/client/network/NetHandlerPlayClient.java
+++ b/net/minecraft/client/network/NetHandlerPlayClient.java
@@ -1,5 +1,9 @@
 package net.minecraft.client.network;
 
+import carpet.network.CarpetClient;
+import carpet.network.CarpetClientNetworkHandler;
+import carpet.settings.CarpetSettings;
+import carpet.utils.LightTrackingHooks;
 import com.google.common.collect.Lists;
 import com.google.common.collect.Maps;
 import com.google.common.util.concurrent.FutureCallback;
@@ -335,6 +339,9 @@
         this.client.playerController.setGameType(packetIn.getGameType());
         this.client.gameSettings.sendSettingsToServer();
         this.netManager.sendPacket(new CPacketCustomPayload(CPacketCustomPayload.BRAND, (new PacketBuffer(Unpooled.buffer())).writeString(ClientBrandRetriever.getClientModName())));
+
+        // Carpet protocol
+        CarpetClient.gameJoined(client.player);
     }
 
     public void handleSpawnObject(SPacketSpawnObject packetIn)
@@ -798,6 +805,10 @@
                 tileentity.read(nbttagcompound);
             }
         }
+        
+        // [TISCM] Newlight
+        if (CarpetSettings.newLight)
+            LightTrackingHooks.onChunkReceive(chunk, packetIn.getExtractedSize());
     }
 
     public void processChunkUnload(SPacketUnloadChunk packetIn)
@@ -818,6 +829,9 @@
     public void handleDisconnect(SPacketDisconnect packetIn)
     {
         this.netManager.closeChannel(packetIn.getReason());
+
+        // Carpet protocol
+        CarpetClient.disconnect();
     }
 
     public void onDisconnect(ITextComponent reason)
@@ -1954,6 +1968,14 @@
 
     public void handleCustomPayload(SPacketCustomPayload packetIn)
     {
+        // Carpet protocol
+        ResourceLocation channel = packetIn.getChannelName();
+        if (CarpetClient.CARPET_CHANNEL.equals(channel))
+        {
+            CarpetClientNetworkHandler.handleData(packetIn.getBufferData(), this.client.player);
+            return;
+        }
+
         PacketThreadUtil.checkThreadAndEnqueue(packetIn, this, this.client);
         ResourceLocation resourcelocation = packetIn.getChannelName();
         PacketBuffer packetbuffer = null;
